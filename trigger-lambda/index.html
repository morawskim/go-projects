<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create AWS event payload</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col">
            <h1>Create AWS event payload</h1>

            <form>
                <div class="mb-3">
                    <label for="event" class="form-label">Email address</label>
                    <select id="event" class="form-select" aria-label="Default select example">
                        <option selected="selected">Select event</option>
                        <optgroup label="S3">
                            <option value="s3/put-object">PutObject</option>
                        </optgroup>
                    </select>
                </div>

                <div id="parameters-s3/put-object" class="d-none payload-parameters">
                    <div class="mb-3">
                        <label for="txtBucket" class="form-label">Bucket</label>
                        <input type="text" class="form-control" id="txtBucket" name="BUCKET_NAME">
                    </div>

                    <div class="mb-3">
                        <label for="txtObjectKey" class="form-label">Object key</label>
                        <input type="text" class="form-control" id="txtObjectKey" name="OBJECT_KEY">
                    </div>
                </div>

                <button id="btnGenerate" type="button" class="btn btn-primary">Generate event payload</button>
            </form>

            <pre id="event-payload" class="mt-3"></pre>
        </div>
    </div>
</div>
</body>

<script type="application/javascript">
    (function () {
        const model = {};

        document.getElementById('event').addEventListener('change', ev => {
            document.getElementById(`parameters-${ev.target.value}`)?.classList?.toggle('d-none');
        });

        document.querySelector('.payload-parameters').addEventListener('change', ev => {
            if (ev.target.tagName !== "INPUT") {
                return;
            }

            model[ev.target.name] = ev.target.value;
        });

        document.getElementById('btnGenerate').addEventListener("click", ev => {
            ev.preventDefault();
            ev.stopPropagation();

            const eventName = document.getElementById('event').value;
            if (!TEMPLATES.hasOwnProperty(eventName)) {
                return;
            }

            let json = TEMPLATES[eventName];

            for (let k in model) {
                if (!model.hasOwnProperty(k)) {
                    continue;
                }

                json = json.replaceAll(`<<${k}>>`, model[k]);
            }
            document.getElementById('event-payload').innerHTML = JSON.stringify(JSON.parse(json), null, 2);
        });

        const TEMPLATES = {
            "s3/put-object": `{"Records":[{"eventVersion":"2.0","eventSource":"aws:s3","awsRegion":"eu-central-1","eventTime":"1970-01-01T00:00:00.000Z","eventName":"ObjectCreated:Put","userIdentity":{"principalId":"EXAMPLE"},"requestParameters":{"sourceIPAddress":"127.0.0.1"},"responseElements":{"x-amz-request-id":"EXAMPLE123456789","x-amz-id-2":"EXAMPLE123/5678abcdefghijklambdaisawesome/mnopqrstuvwxyzABCDEFGH"},"s3":{"s3SchemaVersion":"1.0","configurationId":"testConfigRule","bucket":{"name":"<<BUCKET_NAME>>","ownerIdentity":{"principalId":"EXAMPLE"},"arn":"arn:aws:s3:::data.linker.shop"},"object":{"key":"<<OBJECT_KEY>>","size":1024,"eTag":"0123456789abcdef0123456789abcdef","sequencer":"0A1B2C3D4E5F678901"}}}]}`,
        }
    })()
</script>
</html>
